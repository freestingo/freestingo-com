{{ define "main" }}
  {{ $currentSectionTitle := .CurrentSection.Title }}

  {{ if .Sections.ByWeight }}
    <div class="flex flex-wrap gap-x-5 leading-snug">
      {{ range .Sections.ByWeight }}
        <div class="flex items-baseline relative">
          <a href="{{ .RelPermalink }}" class="not-prose font-semibold text-zinc-950 dark:text-zinc-50 hover:text-emerald-600 hover:dark:text-emerald-400">
            {{ .Title | lower }}
          </a>
          <div class="absolute -right-2 text-xs font-semibold select-none pointer-events-none">{{ .RegularPages | len }}</div>
        </div>
      {{ end }}
    </div>

    <div class="text-zinc-950 dark:text-zinc-50">
      {{ range .Sections.ByWeight }}
        {{ with .RegularPages }}
          {{ range . }}
            {{- partial "article-preview.html" . -}}
          {{ end }}
        {{ end }}
      {{ end }}
    </div>
  {{ else if ne .Parent site.Home }}
    <div class="flex flex-wrap gap-x-5 leading-snug">
      {{ range .Parent.Sections.ByWeight }}
        {{ $isCurrentSection := eq .Title $.CurrentSection.Title }}
        <div class="flex items-baseline relative">
          <a href="{{ if $isCurrentSection }}{{ .Parent.RelPermalink }}{{ else }}{{ .RelPermalink }}{{ end }}" class="not-prose font-semibold {{ if $isCurrentSection }} text-emerald-600 dark:text-emerald-400 {{ else }} text-zinc-950 dark:text-zinc-50 {{ end }} hover:text-emerald-600 hover:dark:text-emerald-400">
            {{ .Title | lower }}
          </a>
          <div class="absolute -right-2 text-xs font-semibold select-none pointer-events-none">{{ .RegularPages | len }}</div>
        </div>
      {{ end }}
    </div>
  {{ end }}

  {{ range $taxonomyName, $taxonomy := ($.Site.Taxonomies) }}
    {{ if eq ($.Parent.Title | lower) $taxonomyName}}
      <div class="flex flex-wrap gap-x-5 text-base leading-snug">
        {{ range $key, $value := $taxonomy }}
          {{ $taxonomyPages := $value.Pages }}
          <div class="flex items-baseline relative">
            {{ $isCurrentSection := eq ($.CurrentSection.Title | lower) $key }}
            {{ $taxonomyPermalink := (index (where ((index $taxonomyPages 0).GetTerms $taxonomyName) ".LinkTitle" (title $key)) 0).RelPermalink }}
            {{ if $isCurrentSection }}
              {{ $taxonomyPermalink = path.Dir (path.Clean $taxonomyPermalink) }}
            {{ end }}
            <a href="{{ $taxonomyPermalink }}" class="not-prose font-semibold {{ if $isCurrentSection }} text-emerald-600 dark:text-emerald-400 {{ else }} text-zinc-950 dark:text-zinc-50 {{ end }} hover:text-emerald-600 hover:dark:text-emerald-400">
              {{ $key }}
            </a>
            <div class="absolute -right-2 text-xs font-semibold select-none pointer-events-none">{{ $taxonomyPages | len }}</div>
          </div>
        {{ end }}
      </div>
    {{ end }}
  {{ end }}

  {{/*  {{ range $taxonomyName, $taxonomy := $.Site.Taxonomies }}
    {{ if eq "topics" $taxonomyName }}
      <div class="flex flex-wrap gap-x-3">
        {{ range $key, $value := $taxonomy }}
          {{ $currentSectionTaxonomies := where $value.Pages ".CurrentSection.Path" $.CurrentSection.Path }}
          {{ if ge $currentSectionTaxonomies 1 }}
            <div class="flex gap-2 items-baseline">
              {{ $taxonomyPermalink := (index (where ((index $currentSectionTaxonomies 0).GetTerms "topics") ".LinkTitle" (title $key)) 0).RelPermalink }}
              <a href="{{ $taxonomyPermalink }}">
                {{ $key }}
              </a>
              <div class="text-xs">{{ $currentSectionTaxonomies | len }}</div>
            </div>
          {{ end }}
        {{ end }}
      </div>
    {{ end }}
  {{ end }}  */}}

  <div class="text-zinc-950 dark:text-zinc-50">
    {{ range .RegularPages }}
      {{- partial "article-preview.html" . -}}
    {{ end }}
  </div>
{{ end }}
